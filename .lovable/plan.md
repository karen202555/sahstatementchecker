

## Disputed Transactions: Simple Report and Copy-to-Email

### The Problem
Right now, when someone marks a transaction as "Disputed", it's saved but there's no easy way to **do anything** with that information -- no report, no way to send it to a provider or plan manager.

### What We'll Build

**One new button: "Export Disputes"** that appears in the top action bar (next to Print, Excel, PDF Report) only when there are disputed transactions. It does two things:

1. **Generates a plain-text dispute summary** in a popup window, formatted as a ready-to-send email/letter
2. **One big "Copy to Clipboard" button** so the user can paste it straight into their email

### Why No Status Tracking

You're right -- status tracking (e.g. "submitted", "under review", "resolved") adds complexity that would confuse users and require ongoing management. The simpler approach: generate the dispute letter, copy it, email it. Done. If they need to follow up, they can export again.

### What the Dispute Summary Looks Like

A clean, plain-text letter format:

```
DISPUTED TRANSACTIONS - STATEMENT REVIEW
=========================================
Date: 24 February 2026
Total disputed items: 3
Total disputed amount: $487.50

-----------------------------------------
1. Date: 15/01/2026
   Description: Nursing - Weekend Visit
   Amount: $245.00
   Reason: This visit did not occur

2. Date: 18/01/2026
   Description: Transport - Taxi
   Amount: $87.50
   Reason: (no reason provided)

3. Date: 22/01/2026
   Description: Meals - Lunch Delivery
   Amount: $155.00
   Reason: Charged twice for the same meal
-----------------------------------------

Please review and respond to the above
disputed charges at your earliest convenience.

Generated by SAH Statement Checker
```

### Also: Include Decisions in PDF Report

The existing PDF report will get a new "Disputed Transactions" section (between Alerts and All Transactions) listing only disputed items with their notes.

---

### Technical Details

**Files to create:**
- `src/lib/dispute-report.ts` -- function that takes transactions + decisions map, filters to disputed ones, and returns formatted plain text

**Files to modify:**

1. **`src/pages/Results.tsx`**
   - Add a "Export Disputes" button (only visible when there are disputed transactions)
   - On click, open a dialog with the formatted text and a "Copy to Clipboard" button
   - Large font, simple layout, clear feedback ("Copied!" toast)

2. **`src/lib/pdf-report.ts`**
   - Add a "Disputed Transactions" section to the existing PDF
   - Accept an optional `decisions` parameter
   - List disputed items with dates, descriptions, amounts, and notes

3. **`src/components/TransactionsTable.tsx`**
   - No changes needed (decisions are already managed here)

**No new database tables or backend changes required** -- this is purely a presentation/export feature using data already stored.

